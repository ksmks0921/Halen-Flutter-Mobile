# Halen

Flutter customer app.


As of 18 Jul 2023 Flutter version on pipeline image is 3.10.6 stable

## Setup Environment for Local Development

- Prerequisites
  - Run the Setup Script for your environment to get you up and running
    - [on Linux](bin/setupLinux.sh)
    - [on macOS with Intel Chip](bin/setupMacOsIntel.sh)
    - [on macOS with Silicon Chip](bin/setupMacOsSilicon.sh)
    - [on Windows](bin/setupWindows.ps1)
  - Configure AWS Amplify
    - [instal AWS Amplify CLI](https://docs.amplify.aws/cli/start/install/)
  - Install Android Studio and Command Line Tools
    - https://developer.android.com/studio
    - https://developer.android.com/tools
  - Install Husky
    ```shell
    dart pub add --dev husky
    dart run husky install
    ```
    - Create Hook
    ```shell
    dart run husky add .husky/pre-commit "dart test"
    git add .husky/pre-commit  
    ``` 

## Flutter Commands

```shell
flutter clean
flutter pub get
flutter pub upgrade --major-versions

- run on LAN
flutter run -d web-server --web-hostname=0.0.0.0 --web-port=8888
```

## How to Lint/Format/Fix

```shell
dart format
dart fix --dry-run
dart fix --apply
```

## How to Test The App

```
flutter emulators
flutter emulators --launch <EMULATOR_ID>
flutter run
```


## Deployment Guide

### original instructions
How to deploy the website with firebase
- Install npm -g firebase-tools
- create token firebase login:ci
- follow the instructions on screen and save the provided token. 
Technically you should be able to use the token in gitlab-ci but
I didn't succeed with it, the token I've been using is saved as an 
environment variable in the repo https://gitlab.com/gsedan-users/MVP/-/settings/ci_cd
to deploy run firebase deploy

- The disabled code for deploying the site on merges to main 
is at https://gitlab.com/gsedan-users/MVP/-/blame/main/.gitlab-ci.yml#L87 (edited)


- Deployments to Firebase for AppStore and Play Store builds happens through codemagic 
on merges to main. Bamba has the same setup with a Halen account that I did with a
personal account as a test. I disabled the personal account so there's no duplication (edited) 


### updated instructions
 after setting up firebase-tools:since changing to public build/web you should run
 - flutter build web --release 
then
 - firebase deploy
 changes to firebase.json autogenerated
```
{
"hosting": {
-    "source": ".",
+    "public": "build/web",
     "ignore": [
     "firebase.json",
     "**/.*",
     "**/node_modules/**"
-    ],
-    "frameworksBackend": {
-      "region": "us-central1"
-    }
+    ]
     }
     }
```

### Release checklist
- startAtPageFlag off
- Set feature flags to default
- check lints
- dart format
